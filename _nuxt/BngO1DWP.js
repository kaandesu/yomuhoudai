import{a8 as w,a9 as k,aa as q,q as v}from"./DPF7tQ9a.js";const C=w("ToastManagerStore",()=>({create:({message:f,toastOps:u={},type:b="default"})=>{switch(b){case"success":return()=>k.success(f,{...u});case"info":return()=>k.info(f,{...u});case"warning":return()=>k.warning(f,{...u});case"error":return()=>k.error(f,{...u});case"loading":return()=>k.loading(f,{...u});default:return()=>k(f,{...u})}}}));function p(d){return C().create(d)}const D=q(),I=D.public.devMode,y=I?"http://127.0.0.1:1234":"https://laravel.yomuhoudai.club",G=w("Library",()=>{const d=v([]),f=v([]),u=v([]),b=v(""),m=v({total:0,perPage:5,currentPage:1,lastPage:0,query:""}),g=v({total:0,perPage:3,currentPage:1,lastPage:0}),c=v(!1),P=()=>$fetch.create({baseURL:y,onResponse({response:n}){var s;d.value=n._data.data??[],d.value.length>0&&p({message:"Books loaded successfully",toastOps:{description:((s=n._data.data)==null?void 0:s.message)??""},type:"success"})()},onResponseError({response:n}){var s;p({message:"Failed to load books",toastOps:{description:((s=n._data)==null?void 0:s.message)??"Unknown error"},type:"error"})()}})("/api/v1/books",{method:"GET"}),$=async({book:l,onSuccess:n,onError:s})=>{const i=$fetch.create({baseURL:y,onResponse({response:r}){var e,o;if(!r.ok)return;p({message:"Book created successfully",toastOps:{description:((e=r._data)==null?void 0:e.message)??""},type:"success"})();const t=(o=r._data)==null?void 0:o.data;t&&(d.value.push(t),g.value.total+=1,n==null||n(t))},onResponseError({response:r}){var t,e;p({message:"Failed to create book",toastOps:{description:((t=r._data)==null?void 0:t.message)??"Unknown error"},type:"error"})(),s==null||s(((e=r._data)==null?void 0:e.message)??"Failed to create book")}});return c.value=!0,i("/api/v1/books",{method:"POST",headers:{"Content-Type":"application/json"},body:l}).finally(()=>{c.value=!1})},U=async({page:l=1,onSuccess:n,onError:s})=>{const i=$fetch.create({baseURL:y,onResponse({response:r}){const t=r._data.data,e=t.data??[],o=g.value.currentPage;if(g.value={total:t.total,perPage:t.per_page,currentPage:t.current_page,lastPage:t.last_page},console.log("eski current",o,"yeni page",g.value.currentPage),o<g.value.currentPage)for(let a=0;a<e.length;a++)d.value.push(e[a]);g.value.currentPage==1&&(d.value=e),e.length>0&&(n==null||n(t))},onResponseError({response:r}){var t,e;p({message:"Failed to fetch the new books",toastOps:{description:((t=r._data)==null?void 0:t.message)??"Unknown error",position:"top-right"},type:"error"})(),s==null||s(((e=r._data)==null?void 0:e.message)??"Unknown error")}});return c.value=!0,i(`/api/v1/books/search/title?q=%20&page=${l}&per_page=${g.value.perPage}`,{method:"GET"}).finally(()=>{c.value=!1})},B=async({book:l,onSuccess:n,onError:s})=>{const i=$fetch.create({baseURL:y,onResponse({response:e}){var o,a;if(e._data.data!=null){const h=e._data.data,_=d.value.findIndex(O=>O.id===h.id);_!==-1&&(d.value[_]={...d.value[_],...h})}p({message:"Book updated successfully",toastOps:{description:((o=e._data)==null?void 0:o.message)??""},type:"success"})(),n==null||n((a=e._data)==null?void 0:a.data)},onResponseError({response:e}){var o,a;p({message:`Failed to update book with id ${l.id}`,toastOps:{description:((o=e._data)==null?void 0:o.message)??"Unknown error"},type:"error"})(),s==null||s(((a=e._data)==null?void 0:a.message)??`Failed to update book with id ${l.id}`)}});c.value=!0;const{id:r,...t}=l;return i(`/api/v1/books/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:t}).finally(()=>{c.value=!1})},L=async({id:l,onSuccess:n,onError:s})=>{const i=$fetch.create({baseURL:y,onResponse({response:r}){var o;p({message:"Book deleted successfully",toastOps:{description:((o=r._data)==null?void 0:o.message)??""},type:"success"})();const t=d.value.findIndex(a=>a.id===l);t!==-1&&d.value.splice(t,1);const e=u.value.findIndex(a=>a.id===l);e!==-1&&u.value.splice(e,1),g.value.total-=1,n==null||n(r._data)},onResponseError({response:r}){var e,o,a;const t=((e=d.value.find(h=>h.id===l))==null?void 0:e.title)??`book with id ${l}`;p({message:`Failed to delete ${t}`,toastOps:{description:((o=r._data)==null?void 0:o.message)??"Unknown error"},type:"error"})(),s==null||s(((a=r._data)==null?void 0:a.message)??`Failed to delete book with id ${l}`)}});return c.value=!0,i(`/api/v1/books/${l}`,{method:"DELETE"}).finally(()=>{c.value=!1})},T=async({type:l,format:n,onSuccess:s,onError:i})=>{const r=$fetch.create({baseURL:y,responseType:"blob",onResponse({response:t}){const e=t._data,o=window.URL.createObjectURL(e),a=document.createElement("a");a.href=o,a.setAttribute("download",`books.${n}`),document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(o),p({message:"Downloaded successfully!",toastOps:{description:""},type:"success"})(),s==null||s(e)},onResponseError({response:t}){var e,o;p({message:"Failed to download books",toastOps:{description:((e=t._data)==null?void 0:e.message)??"Unknown error"},type:"error"})(),i==null||i(((o=t._data)==null?void 0:o.message)??"Failed to export")}});return c.value=!0,r(`/api/v1/books/export?type=${l}&format=${n}`,{method:"GET"}).finally(()=>{c.value=!1})},R=l=>async({page:n=1,onSuccess:s,onError:i})=>{const r=b.value,t=r??m.value.query??"",e=$fetch.create({baseURL:y,onResponse({response:o}){const a=o._data.data;u.value=a.data??[],m.value={total:a.total,perPage:a.per_page,currentPage:a.current_page,lastPage:a.last_page,query:r??""},u.value.length>0&&(s==null||s(a))},onResponseError({response:o}){var a,h;p({message:"Failed to search books by title",toastOps:{description:((a=o._data)==null?void 0:a.message)??"Unknown error",position:"top-right"},type:"error"})(),i==null||i(((h=o._data)==null?void 0:h.message)??"Search failed")}});return c.value=!0,e(`/api/v1/books/search/${l}?q=${encodeURIComponent(t)}&page=${n}${m.value.perPage>=5?`&per_page=${m.value.perPage}`:""}`,{method:"GET"}).finally(()=>{c.value=!1})},F=R("title"),x=R("author");return{loading:c,books:d,searchResults:u,getBooksPaginated:U,overviewPaginationData:g,getBooks:P,createBook:$,updateBook:B,deleteBook:L,suggestions:f,downloadBooks:T,searchBooksByTitle:F,searchBooksByAuthor:x,searchData:m,searchQuery:b}},{persist:{}});export{p as c,G as u};
