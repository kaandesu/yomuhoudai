import{a8 as g,q as y}from"./B_cpReyO.js";import{c as l}from"./DHWenwcM.js";var b={};const v=b.DEV_MODE==="true",f=v?"http://127.0.0.1:1234":"https://laravel.yomuhoudai.club",x=g("Library",()=>{const c=y([]),k=y([]),n=y(!1);return{loading:n,books:c,getBooks:()=>$fetch.create({baseURL:f,onResponse({response:o}){var t;c.value=o._data.data??[],c.value.length>0&&l({message:"Books loaded successfully",toastOps:{description:((t=o._data.data)==null?void 0:t.message)??""},type:"success"})()},onResponseError({response:o}){var t;l({message:"Failed to load books",toastOps:{description:((t=o._data)==null?void 0:t.message)??"Unknown error"},type:"error"})()}})("/api/v1/books",{method:"GET"}),getBookById:async({id:d,onSuccess:o,onError:t})=>{const p=$fetch.create({baseURL:f,onResponse({response:s}){var a,e;l({message:"Book loaded successfully",toastOps:{description:((a=s._data)==null?void 0:a.message)??""},type:"success"})(),o==null||o((e=s._data)==null?void 0:e.data)},onResponseError({response:s}){var a,e;l({message:`Failed to load book with id ${d}`,toastOps:{description:((a=s._data)==null?void 0:a.message)??"Unknown error"},type:"error"})(),t==null||t(((e=s._data)==null?void 0:e.message)??`Error loading book with id ${d}`)}});return n.value=!0,p(`/api/v1/books/${d}`,{method:"GET"}).finally(()=>{n.value=!1})},createBook:async({book:d,onSuccess:o,onError:t})=>{const p=$fetch.create({baseURL:f,onResponse({response:s}){var e,i;if(!s.ok)return;l({message:"Book created successfully",toastOps:{description:((e=s._data)==null?void 0:e.message)??""},type:"success"})();const a=(i=s._data)==null?void 0:i.data;a&&(c.value.push(a),o==null||o(a))},onResponseError({response:s}){var a,e;l({message:"Failed to create book",toastOps:{description:((a=s._data)==null?void 0:a.message)??"Unknown error"},type:"error"})(),t==null||t(((e=s._data)==null?void 0:e.message)??"Failed to create book")}});return n.value=!0,p("/api/v1/books",{method:"POST",headers:{"Content-Type":"application/json"},body:d}).finally(()=>{n.value=!1})},updateBook:async({book:d,onSuccess:o,onError:t})=>{const p=$fetch.create({baseURL:f,onResponse({response:e}){var i,r;if(e._data.data!=null){const u=e._data.data,m=c.value.findIndex(h=>h.id===u.id);m!==-1&&(c.value[m]={...c.value[m],...u})}l({message:"Book updated successfully",toastOps:{description:((i=e._data)==null?void 0:i.message)??""},type:"success"})(),o==null||o((r=e._data)==null?void 0:r.data)},onResponseError({response:e}){var i,r;l({message:`Failed to update book with id ${d.id}`,toastOps:{description:((i=e._data)==null?void 0:i.message)??"Unknown error"},type:"error"})(),t==null||t(((r=e._data)==null?void 0:r.message)??`Failed to update book with id ${d.id}`)}});n.value=!0;const{id:s,...a}=d;return p(`/api/v1/books/${d.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:a}).finally(()=>{n.value=!1})},deleteBook:async({id:d,onSuccess:o,onError:t})=>{const p=$fetch.create({baseURL:f,onResponse({response:s}){var e;l({message:"Book deleted successfully",toastOps:{description:((e=s._data)==null?void 0:e.message)??""},type:"success"})();const a=c.value.findIndex(i=>i.id===d);a!==-1&&c.value.splice(a,1),o==null||o(s._data)},onResponseError({response:s}){var e,i,r;const a=((e=c.value.find(u=>u.id===d))==null?void 0:e.title)??`book with id ${d}`;l({message:`Failed to delete ${a}`,toastOps:{description:((i=s._data)==null?void 0:i.message)??"Unknown error"},type:"error"})(),t==null||t(((r=s._data)==null?void 0:r.message)??`Failed to delete book with id ${d}`)}});return n.value=!0,p(`/api/v1/books/${d}`,{method:"DELETE"}).finally(()=>{n.value=!1})},suggestions:k,downloadBooks:async({type:d,format:o,onSuccess:t,onError:p})=>{const s=$fetch.create({baseURL:f,responseType:"blob",onResponse({response:a}){const e=a._data,i=window.URL.createObjectURL(e),r=document.createElement("a");r.href=i,r.setAttribute("download",`books.${o}`),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(i),l({message:"Downloaded successfully!",toastOps:{description:""},type:"success"})(),t==null||t(e)},onResponseError({response:a}){var e,i;l({message:"Failed to download books",toastOps:{description:((e=a._data)==null?void 0:e.message)??"Unknown error"},type:"error"})(),p==null||p(((i=a._data)==null?void 0:i.message)??"Failed to export")}});return n.value=!0,s(`/api/v1/books/export?type=${d}&format=${o}`,{method:"GET"}).finally(()=>{n.value=!1})},searchBooksByTitle:async({title:d,onSuccess:o,onError:t})=>{const p=$fetch.create({baseURL:f,onResponse({response:s}){var a,e;l({message:"Books found by title",toastOps:{description:((a=s._data)==null?void 0:a.message)??""},type:"success"})(),o==null||o((e=s._data)==null?void 0:e.data)},onResponseError({response:s}){var a,e;l({message:"Failed to search books by title",toastOps:{description:((a=s._data)==null?void 0:a.message)??"Unknown error"},type:"error"})(),t==null||t(((e=s._data)==null?void 0:e.message)??"Search failed")}});return n.value=!0,p(`/api/v1/books/search/title?q=${encodeURIComponent(d)}`,{method:"GET"}).finally(()=>{n.value=!1})},searchBooksByAuthor:async({author:d,onSuccess:o,onError:t})=>{const p=$fetch.create({baseURL:f,onResponse({response:s}){var a,e;l({message:"Books found by author",toastOps:{description:((a=s._data)==null?void 0:a.message)??""},type:"success"})(),o==null||o((e=s._data)==null?void 0:e.data)},onResponseError({response:s}){var a,e;l({message:"Failed to search books by author",toastOps:{description:((a=s._data)==null?void 0:a.message)??"Unknown error"},type:"error"})(),t==null||t(((e=s._data)==null?void 0:e.message)??"Search failed")}});return n.value=!0,p(`/api/v1/books/search/author?q=${encodeURIComponent(d)}`,{method:"GET"}).finally(()=>{n.value=!1})}}},{persist:{}});export{x as u};
