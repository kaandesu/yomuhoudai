import{a8 as P,a9 as y,aa as L,q as f}from"./B40UMO3j.js";const x=P("ToastManagerStore",()=>({create:({message:h,toastOps:c={},type:d="default"})=>{switch(d){case"success":return()=>y.success(h,{...c});case"info":return()=>y.info(h,{...c});case"warning":return()=>y.warning(h,{...c});case"error":return()=>y.error(h,{...c});case"loading":return()=>y.loading(h,{...c});default:return()=>y(h,{...c})}}}));function p(m){return x().create(m)}const G=P("Library",()=>{const c=L().public.devMode!=="false"?"http://127.0.0.1:1234":"https://laravel.yomuhoudai.club",d=f([]),U=f([]),k=f([]),R=f("asc"),T=f("title"),$=f(""),b=f({total:0,perPage:5,currentPage:1,lastPage:0,query:""}),g=f({total:0,perPage:3,currentPage:1,lastPage:0}),u=f(!1);return{loading:u,books:d,searchResults:k,getBooksPaginated:async({page:r=1,onSuccess:n,onError:o})=>{const i=$fetch.create({baseURL:c,onResponse({response:l}){const t=l._data.data,e=t.data??[],s=g.value.currentPage;if(g.value={total:t.total,perPage:t.per_page,currentPage:t.current_page,lastPage:t.last_page},s<g.value.currentPage)for(let a=0;a<e.length;a++)d.value.push(e[a]);g.value.currentPage==1&&(d.value=e),e.length>0&&(n==null||n(t))},onResponseError({response:l}){var t,e;p({message:"Failed to fetch the new books",toastOps:{description:((t=l._data)==null?void 0:t.message)??"Unknown error",position:"top-right"},type:"error"})(),o==null||o(((e=l._data)==null?void 0:e.message)??"Unknown error")}});return u.value=!0,i(`/api/v1/books/search/title?q=%20&page=${r}&per_page=${g.value.perPage}`,{method:"GET"}).finally(()=>{u.value=!1})},overviewPaginationData:g,getBooks:()=>$fetch.create({baseURL:c,onResponse({response:n}){var o;d.value=n._data.data??[],d.value.length>0&&(g.value.total=d.value.length,p({message:"Books loaded successfully",toastOps:{description:((o=n._data.data)==null?void 0:o.message)??""},type:"success"})())},onResponseError({response:n}){var o;p({message:"Failed to load books",toastOps:{description:((o=n._data)==null?void 0:o.message)??"Unknown error"},type:"error"})()}})("/api/v1/books",{method:"GET"}),createBook:async({book:r,onSuccess:n,onError:o})=>{const i=$fetch.create({baseURL:c,onResponse({response:l}){var e,s;if(!l.ok)return;p({message:"Book created successfully",toastOps:{description:((e=l._data)==null?void 0:e.message)??""},type:"success"})();const t=(s=l._data)==null?void 0:s.data;t&&(d.value.push(t),g.value.total+=1,n==null||n(t))},onResponseError({response:l}){var t,e;p({message:"Failed to create book",toastOps:{description:((t=l._data)==null?void 0:t.message)??"Unknown error"},type:"error"})(),o==null||o(((e=l._data)==null?void 0:e.message)??"Failed to create book")}});return u.value=!0,i("/api/v1/books",{method:"POST",headers:{"Content-Type":"application/json"},body:r}).finally(()=>{u.value=!1})},updateBook:async({book:r,onSuccess:n,onError:o})=>{const i=$fetch.create({baseURL:c,onResponse({response:e}){var s,a;if(e._data.data!=null){const v=e._data.data,_=d.value.findIndex(w=>w.id===v.id);_!==-1&&(d.value[_]={...d.value[_],...v});const B=k.value.findIndex(w=>w.id===v.id);B!==-1&&k.value.splice(B,1)}p({message:"Book updated successfully",toastOps:{description:((s=e._data)==null?void 0:s.message)??""},type:"success"})(),n==null||n((a=e._data)==null?void 0:a.data)},onResponseError({response:e}){var s,a;p({message:`Failed to update book with id ${r.id}`,toastOps:{description:((s=e._data)==null?void 0:s.message)??"Unknown error"},type:"error"})(),o==null||o(((a=e._data)==null?void 0:a.message)??`Failed to update book with id ${r.id}`)}});u.value=!0;const{id:l,...t}=r;return i(`/api/v1/books/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:t}).finally(()=>{u.value=!1})},deleteBook:async({id:r,onSuccess:n,onError:o})=>{const i=$fetch.create({baseURL:c,onResponse({response:l}){var s;p({message:"Book deleted successfully",toastOps:{description:((s=l._data)==null?void 0:s.message)??""},type:"success"})();const t=d.value.findIndex(a=>a.id===r);t!==-1&&d.value.splice(t,1);const e=k.value.findIndex(a=>a.id===r);e!==-1&&k.value.splice(e,1),g.value.total-=1,n==null||n(l._data)},onResponseError({response:l}){var e,s,a;const t=((e=d.value.find(v=>v.id===r))==null?void 0:e.title)??`book with id ${r}`;p({message:`Failed to delete ${t}`,toastOps:{description:((s=l._data)==null?void 0:s.message)??"Unknown error"},type:"error"})(),o==null||o(((a=l._data)==null?void 0:a.message)??`Failed to delete book with id ${r}`)}});return u.value=!0,i(`/api/v1/books/${r}`,{method:"DELETE"}).finally(()=>{u.value=!1})},suggestions:U,downloadBooks:async({type:r,format:n,onSuccess:o,onError:i})=>{const l=$fetch.create({baseURL:c,responseType:"blob",onResponse({response:t}){if(!t.ok)return;const e=t._data,s=window.URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.setAttribute("download",`books.${n}`),document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(s),p({message:"Downloaded successfully!",toastOps:{description:""},type:"success"})(),o==null||o(e)},onResponseError({response:t}){var e,s;p({message:"Failed to download books",toastOps:{description:((e=t._data)==null?void 0:e.message)??"Unknown error"},type:"error"})(),i==null||i(((s=t._data)==null?void 0:s.message)??"Failed to export")}});return u.value=!0,l(`/api/v1/books/export?type=${r}&format=${n}`,{method:"GET"}).finally(()=>{u.value=!1})},searchData:b,searchQuery:$,searchSortTab:R,searchFieldTab:T,searchBooksBy:r=>async({page:n=1,onSuccess:o,onError:i})=>{const l=$.value,t=l??b.value.query??"",e=$fetch.create({baseURL:c,onResponse({response:s}){const a=s._data.data;k.value=a.data??[],b.value={total:a.total,perPage:a.per_page,currentPage:a.current_page,lastPage:a.last_page,query:l??""},k.value.length>0&&(o==null||o(a))},onResponseError({response:s}){var a,v;p({message:"Failed to search books by title",toastOps:{description:((a=s._data)==null?void 0:a.message)??"Unknown error",position:"top-right"},type:"error"})(),i==null||i(((v=s._data)==null?void 0:v.message)??"Search failed")}});return u.value=!0,e(`/api/v1/books/search/${r}?q=${encodeURIComponent(t)}&page=${n}${b.value.perPage>=5?`&per_page=${b.value.perPage}`:""}&sort=${r}&direction=${R.value}`,{method:"GET"}).finally(()=>{u.value=!1})}}},{persist:{}});export{p as c,G as u};
