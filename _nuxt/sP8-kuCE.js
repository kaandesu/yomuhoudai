import{a8 as L,a9 as y,aa as M,q as v,Z as P}from"./BGXm4l_S.js";const j=L("ToastManagerStore",()=>({create:({message:h,toastOps:u={},type:i="default"})=>{switch(i){case"success":return()=>y.success(h,{...u});case"info":return()=>y.info(h,{...u});case"warning":return()=>y.warning(h,{...u});case"error":return()=>y.error(h,{...u});case"loading":return()=>y.loading(h,{...u});default:return()=>y(h,{...u})}}}));function g(w){return j().create(w)}const I=L("Library",()=>{const u=M().public.devMode!=="false"?"http://127.0.0.1:1234":"https://laravel.yomuhoudai.club",i=v([]),T=v([]),_=v([]),$=v("asc"),b=v("title"),U=v(""),f=v({total:0,perPage:5,currentPage:1,lastPage:0,query:""}),c=v({total:0,perPage:3,currentPage:1,lastPage:0}),p=v(!1),x=()=>$fetch.create({baseURL:u,onResponse({response:s}){var t;i.value=s._data.data??[],i.value.length>0&&(c.value.total=i.value.length,g({message:"Books loaded successfully",toastOps:{description:((t=s._data.data)==null?void 0:t.message)??""},type:"success"})())},onResponseError({response:s}){var t;g({message:"Failed to load books",toastOps:{description:((t=s._data)==null?void 0:t.message)??"Unknown error"},type:"error"})()}})("/api/v1/books",{method:"GET"}),F=async({book:l,onSuccess:s,onError:t})=>{const d=$fetch.create({baseURL:u,onResponse({response:r}){var e,o;if(!r.ok)return;g({message:"Book created successfully",toastOps:{description:((e=r._data)==null?void 0:e.message)??""},type:"success"})();const a=(o=r._data)==null?void 0:o.data;a&&(i.value.length==c.value.total&&i.value.push(a),c.value.total+=1,m(b.value)({}),s==null||s(a))},onResponseError({response:r}){var a,e;g({message:"Failed to create book",toastOps:{description:((a=r._data)==null?void 0:a.message)??"Unknown error"},type:"error"})(),t==null||t(((e=r._data)==null?void 0:e.message)??"Failed to create book")}});return p.value=!0,d("/api/v1/books",{method:"POST",headers:{"Content-Type":"application/json"},body:l}).finally(()=>{p.value=!1})},B=async({page:l=1,onSuccess:s,onError:t})=>{const d=$fetch.create({baseURL:u,onResponse({response:r}){if(!r.ok)return;const a=r._data.data,e=a.data??[],o=c.value.currentPage;c.value={total:a.total,perPage:a.per_page,currentPage:a.current_page,lastPage:a.last_page},o<c.value.currentPage?i.value.push(...e):c.value.currentPage==1&&(i.value=e),c.value.currentPage>=c.value.lastPage&&i.value.length<c.value.total&&g({message:"Some books might be missing",toastOps:{description:P("div",[P("span","A new book may have been added to an earlier page."),P("button",{style:{marginLeft:"8px",backgroundColor:"#facc14",color:"white",padding:"4px 8px",borderRadius:"4px",cursor:"pointer"},onClick:()=>{B({page:1})}},"Refresh books")]),position:"top-right",duration:8e3},type:"warning"})(),e.length>0&&(s==null||s(a))},onResponseError({response:r}){var a,e;g({message:"Failed to fetch the new books",toastOps:{description:((a=r._data)==null?void 0:a.message)??"Unknown error",position:"top-right"},type:"error"})(),t==null||t(((e=r._data)==null?void 0:e.message)??"Unknown error")}});return p.value=!0,d(`/api/v1/books/search/title?q=%20&page=${l}&per_page=${c.value.perPage}`,{method:"GET"}).finally(()=>{p.value=!1})},O=async({book:l,onSuccess:s,onError:t})=>{const d=$fetch.create({baseURL:u,onResponse({response:e}){var o,n;if(e.ok){if(e._data.data!=null){const k=e._data.data,R=i.value.findIndex(D=>D.id===k.id);R!==-1&&(i.value[R]={...i.value[R],...k})}m(b.value)({}),g({message:"Book updated successfully",toastOps:{description:((o=e._data)==null?void 0:o.message)??""},type:"success"})(),s==null||s((n=e._data)==null?void 0:n.data)}},onResponseError({response:e}){var o,n;g({message:`Failed to update book with id ${l.id}`,toastOps:{description:((o=e._data)==null?void 0:o.message)??"Unknown error"},type:"error"})(),t==null||t(((n=e._data)==null?void 0:n.message)??`Failed to update book with id ${l.id}`)}});p.value=!0;const{id:r,...a}=l;return d(`/api/v1/books/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:a}).finally(()=>{p.value=!1})},q=async({id:l,onSuccess:s,onError:t})=>{const d=$fetch.create({baseURL:u,onResponse({response:r}){var e;if(!r.ok)return;g({message:"Book deleted successfully",toastOps:{description:((e=r._data)==null?void 0:e.message)??""},type:"success"})();const a=i.value.findIndex(o=>o.id===l);a!==-1&&i.value.splice(a,1),_.value.length==1&&f.value.currentPage>=2?m(b.value)({page:f.value.currentPage-1}):m(b.value)({}),c.value.total-=1,s==null||s(r._data)},onResponseError({response:r}){var e,o,n;const a=((e=i.value.find(k=>k.id===l))==null?void 0:e.title)??`book with id ${l}`;g({message:`Failed to delete ${a}`,toastOps:{description:((o=r._data)==null?void 0:o.message)??"Unknown error"},type:"error"})(),t==null||t(((n=r._data)==null?void 0:n.message)??`Failed to delete book with id ${l}`)}});return p.value=!0,d(`/api/v1/books/${l}`,{method:"DELETE"}).finally(()=>{p.value=!1})},C=async({type:l,format:s,onSuccess:t,onError:d})=>{const r=$fetch.create({baseURL:u,responseType:"blob",onResponse({response:a}){if(!a.ok)return;const e=a._data,o=window.URL.createObjectURL(e),n=document.createElement("a");n.href=o,n.setAttribute("download",`books.${s}`),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(o),g({message:"Downloaded successfully!",toastOps:{description:""},type:"success"})(),t==null||t(e)},onResponseError({response:a}){var e,o;g({message:"Failed to download books",toastOps:{description:((e=a._data)==null?void 0:e.message)??"Unknown error"},type:"error"})(),d==null||d(((o=a._data)==null?void 0:o.message)??"Failed to export")}});return p.value=!0,r(`/api/v1/books/export?type=${l}&format=${s}`,{method:"GET"}).finally(()=>{p.value=!1})},m=l=>async({page:s=f.value.currentPage,onSuccess:t,onError:d})=>{const r=U.value,a=r??f.value.query??"",e=$fetch.create({baseURL:u,onResponse({response:o}){if(!o.ok)return;const n=o._data.data;f.value={total:n.total,perPage:n.per_page,currentPage:n.current_page,lastPage:n.last_page,query:r??""},_.value=n.data??[],_.value.length>0&&(t==null||t(n))},onResponseError({response:o}){var n,k;g({message:"Failed to search books by title",toastOps:{description:((n=o._data)==null?void 0:n.message)??"Unknown error",position:"top-right"},type:"error"})(),d==null||d(((k=o._data)==null?void 0:k.message)??"Search failed")}});return p.value=!0,e(`/api/v1/books/search/${l}?q=${encodeURIComponent(a)}&page=${s}${f.value.perPage>=5?`&per_page=${f.value.perPage}`:""}&sort=${l}&direction=${$.value}`,{method:"GET"}).finally(()=>{p.value=!1})};return{loading:p,books:i,searchResults:_,getBooksPaginated:B,overviewPaginationData:c,getBooks:x,createBook:F,updateBook:O,deleteBook:q,suggestions:T,downloadBooks:C,searchData:f,searchQuery:U,searchSortTab:$,searchFieldTab:b,searchBooksBy:m}},{persist:{}});export{g as c,I as u};
