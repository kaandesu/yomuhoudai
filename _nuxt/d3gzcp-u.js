import{a8 as F,a9 as P,q as g}from"./BP3OBRWp.js";import{c}from"./n-24vFvo.js";const x=P(),q=x.public.devMode,f=q?"http://127.0.0.1:1234":"https://laravel.yomuhoudai.club",j=F("Library",()=>{const p=g([]),b=g([]),y=g([]),v=g(""),h=g({total:0,perPage:5,currentPage:1,lastPage:0,query:""}),r=g(!1),_=o=>{h.value={total:o.total,perPage:o.per_page,currentPage:o.current_page,lastPage:o.last_page,query:o.query}},R=()=>$fetch.create({baseURL:f,onResponse({response:d}){var t;p.value=d._data.data??[],p.value.length>0&&c({message:"Books loaded successfully",toastOps:{description:((t=d._data.data)==null?void 0:t.message)??""},type:"success"})()},onResponseError({response:d}){var t;c({message:"Failed to load books",toastOps:{description:((t=d._data)==null?void 0:t.message)??"Unknown error"},type:"error"})()}})("/api/v1/books",{method:"GET"}),$=async({book:o,onSuccess:d,onError:t})=>{const n=$fetch.create({baseURL:f,onResponse({response:i}){var a,s;if(!i.ok)return;c({message:"Book created successfully",toastOps:{description:((a=i._data)==null?void 0:a.message)??""},type:"success"})();const l=(s=i._data)==null?void 0:s.data;l&&(p.value.push(l),d==null||d(l))},onResponseError({response:i}){var l,a;c({message:"Failed to create book",toastOps:{description:((l=i._data)==null?void 0:l.message)??"Unknown error"},type:"error"})(),t==null||t(((a=i._data)==null?void 0:a.message)??"Failed to create book")}});return r.value=!0,n("/api/v1/books",{method:"POST",headers:{"Content-Type":"application/json"},body:o}).finally(()=>{r.value=!1})},w=async({book:o,onSuccess:d,onError:t})=>{const n=$fetch.create({baseURL:f,onResponse({response:a}){var s,e;if(a._data.data!=null){const u=a._data.data,m=p.value.findIndex(T=>T.id===u.id);m!==-1&&(p.value[m]={...p.value[m],...u})}c({message:"Book updated successfully",toastOps:{description:((s=a._data)==null?void 0:s.message)??""},type:"success"})(),d==null||d((e=a._data)==null?void 0:e.data)},onResponseError({response:a}){var s,e;c({message:`Failed to update book with id ${o.id}`,toastOps:{description:((s=a._data)==null?void 0:s.message)??"Unknown error"},type:"error"})(),t==null||t(((e=a._data)==null?void 0:e.message)??`Failed to update book with id ${o.id}`)}});r.value=!0;const{id:i,...l}=o;return n(`/api/v1/books/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:l}).finally(()=>{r.value=!1})},U=async({id:o,onSuccess:d,onError:t})=>{const n=$fetch.create({baseURL:f,onResponse({response:i}){var s;c({message:"Book deleted successfully",toastOps:{description:((s=i._data)==null?void 0:s.message)??""},type:"success"})();const l=p.value.findIndex(e=>e.id===o);l!==-1&&p.value.splice(l,1);const a=y.value.findIndex(e=>e.id===o);a!==-1&&y.value.splice(a,1),d==null||d(i._data)},onResponseError({response:i}){var a,s,e;const l=((a=p.value.find(u=>u.id===o))==null?void 0:a.title)??`book with id ${o}`;c({message:`Failed to delete ${l}`,toastOps:{description:((s=i._data)==null?void 0:s.message)??"Unknown error"},type:"error"})(),t==null||t(((e=i._data)==null?void 0:e.message)??`Failed to delete book with id ${o}`)}});return r.value=!0,n(`/api/v1/books/${o}`,{method:"DELETE"}).finally(()=>{r.value=!1})},B=async({type:o,format:d,onSuccess:t,onError:n})=>{const i=$fetch.create({baseURL:f,responseType:"blob",onResponse({response:l}){const a=l._data,s=window.URL.createObjectURL(a),e=document.createElement("a");e.href=s,e.setAttribute("download",`books.${d}`),document.body.appendChild(e),e.click(),e.remove(),window.URL.revokeObjectURL(s),c({message:"Downloaded successfully!",toastOps:{description:""},type:"success"})(),t==null||t(a)},onResponseError({response:l}){var a,s;c({message:"Failed to download books",toastOps:{description:((a=l._data)==null?void 0:a.message)??"Unknown error"},type:"error"})(),n==null||n(((s=l._data)==null?void 0:s.message)??"Failed to export")}});return r.value=!0,i(`/api/v1/books/export?type=${o}&format=${d}`,{method:"GET"}).finally(()=>{r.value=!1})},k=o=>async({page:d=1,onSuccess:t,onError:n})=>{const i=v.value,l=i??h.value.query??"",a=$fetch.create({baseURL:f,onResponse({response:s}){const e=s._data.data;y.value=e.data??[],_({total:e.total,per_page:e.per_page,current_page:e.current_page,last_page:e.last_page,query:i??""}),y.value.length>0&&(t==null||t(e))},onResponseError({response:s}){var e,u;c({message:"Failed to search books by title",toastOps:{description:((e=s._data)==null?void 0:e.message)??"Unknown error",position:"top-right"},type:"error"})(),n==null||n(((u=s._data)==null?void 0:u.message)??"Search failed")}});return r.value=!0,a(`/api/v1/books/search/${o}?q=${encodeURIComponent(l)}&page=${d}${h.value.perPage>=5?`&per_page=${h.value.perPage}`:""}`,{method:"GET"}).finally(()=>{r.value=!1})},O=k("title"),L=k("author");return{loading:r,books:p,searchResults:y,getBooks:R,createBook:$,updateBook:w,deleteBook:U,suggestions:b,downloadBooks:B,searchBooksByTitle:O,searchBooksByAuthor:L,searchData:h,searchQuery:v}},{persist:{}});export{j as u};
