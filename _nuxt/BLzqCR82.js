import{a8 as $,a9 as k,aa as T,q as g}from"./DjukKYQC.js";const L=$("ToastManagerStore",()=>({create:({message:v,toastOps:i={},type:c="default"})=>{switch(c){case"success":return()=>k.success(v,{...i});case"info":return()=>k.info(v,{...i});case"warning":return()=>k.warning(v,{...i});case"error":return()=>k.error(v,{...i});case"loading":return()=>k.loading(v,{...i});default:return()=>k(v,{...i})}}}));function p(m){return L().create(m)}const j=$("Library",()=>{const i=T().public.devMode!=="false"?"http://127.0.0.1:1234":"https://laravel.yomuhoudai.club",c=g([]),B=g([]),y=g([]),w=g("asc"),P=g("title"),R=g(""),b=g({total:0,perPage:5,currentPage:1,lastPage:0,query:""}),f=g({total:0,perPage:3,currentPage:1,lastPage:0}),u=g(!1);return{loading:u,books:c,searchResults:y,getBooksPaginated:async({page:l=1,onSuccess:n,onError:s})=>{const d=$fetch.create({baseURL:i,onResponse({response:r}){const t=r._data.data,e=t.data??[],o=f.value.currentPage;if(f.value={total:t.total,perPage:t.per_page,currentPage:t.current_page,lastPage:t.last_page},o<f.value.currentPage)for(let a=0;a<e.length;a++)c.value.push(e[a]);f.value.currentPage==1&&(c.value=e),e.length>0&&(n==null||n(t))},onResponseError({response:r}){var t,e;p({message:"Failed to fetch the new books",toastOps:{description:((t=r._data)==null?void 0:t.message)??"Unknown error",position:"top-right"},type:"error"})(),s==null||s(((e=r._data)==null?void 0:e.message)??"Unknown error")}});return u.value=!0,d(`/api/v1/books/search/title?q=%20&page=${l}&per_page=${f.value.perPage}`,{method:"GET"}).finally(()=>{u.value=!1})},overviewPaginationData:f,getBooks:()=>$fetch.create({baseURL:i,onResponse({response:n}){var s;c.value=n._data.data??[],c.value.length>0&&p({message:"Books loaded successfully",toastOps:{description:((s=n._data.data)==null?void 0:s.message)??""},type:"success"})()},onResponseError({response:n}){var s;p({message:"Failed to load books",toastOps:{description:((s=n._data)==null?void 0:s.message)??"Unknown error"},type:"error"})()}})("/api/v1/books",{method:"GET"}),createBook:async({book:l,onSuccess:n,onError:s})=>{const d=$fetch.create({baseURL:i,onResponse({response:r}){var e,o;if(!r.ok)return;p({message:"Book created successfully",toastOps:{description:((e=r._data)==null?void 0:e.message)??""},type:"success"})();const t=(o=r._data)==null?void 0:o.data;t&&(c.value.push(t),f.value.total+=1,n==null||n(t))},onResponseError({response:r}){var t,e;p({message:"Failed to create book",toastOps:{description:((t=r._data)==null?void 0:t.message)??"Unknown error"},type:"error"})(),s==null||s(((e=r._data)==null?void 0:e.message)??"Failed to create book")}});return u.value=!0,d("/api/v1/books",{method:"POST",headers:{"Content-Type":"application/json"},body:l}).finally(()=>{u.value=!1})},updateBook:async({book:l,onSuccess:n,onError:s})=>{const d=$fetch.create({baseURL:i,onResponse({response:e}){var o,a;if(e._data.data!=null){const h=e._data.data,_=c.value.findIndex(U=>U.id===h.id);_!==-1&&(c.value[_]={...c.value[_],...h})}p({message:"Book updated successfully",toastOps:{description:((o=e._data)==null?void 0:o.message)??""},type:"success"})(),n==null||n((a=e._data)==null?void 0:a.data)},onResponseError({response:e}){var o,a;p({message:`Failed to update book with id ${l.id}`,toastOps:{description:((o=e._data)==null?void 0:o.message)??"Unknown error"},type:"error"})(),s==null||s(((a=e._data)==null?void 0:a.message)??`Failed to update book with id ${l.id}`)}});u.value=!0;const{id:r,...t}=l;return d(`/api/v1/books/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:t}).finally(()=>{u.value=!1})},deleteBook:async({id:l,onSuccess:n,onError:s})=>{const d=$fetch.create({baseURL:i,onResponse({response:r}){var o;p({message:"Book deleted successfully",toastOps:{description:((o=r._data)==null?void 0:o.message)??""},type:"success"})();const t=c.value.findIndex(a=>a.id===l);t!==-1&&c.value.splice(t,1);const e=y.value.findIndex(a=>a.id===l);e!==-1&&y.value.splice(e,1),f.value.total-=1,n==null||n(r._data)},onResponseError({response:r}){var e,o,a;const t=((e=c.value.find(h=>h.id===l))==null?void 0:e.title)??`book with id ${l}`;p({message:`Failed to delete ${t}`,toastOps:{description:((o=r._data)==null?void 0:o.message)??"Unknown error"},type:"error"})(),s==null||s(((a=r._data)==null?void 0:a.message)??`Failed to delete book with id ${l}`)}});return u.value=!0,d(`/api/v1/books/${l}`,{method:"DELETE"}).finally(()=>{u.value=!1})},suggestions:B,downloadBooks:async({type:l,format:n,onSuccess:s,onError:d})=>{const r=$fetch.create({baseURL:i,responseType:"blob",onResponse({response:t}){const e=t._data,o=window.URL.createObjectURL(e),a=document.createElement("a");a.href=o,a.setAttribute("download",`books.${n}`),document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(o),p({message:"Downloaded successfully!",toastOps:{description:""},type:"success"})(),s==null||s(e)},onResponseError({response:t}){var e,o;p({message:"Failed to download books",toastOps:{description:((e=t._data)==null?void 0:e.message)??"Unknown error"},type:"error"})(),d==null||d(((o=t._data)==null?void 0:o.message)??"Failed to export")}});return u.value=!0,r(`/api/v1/books/export?type=${l}&format=${n}`,{method:"GET"}).finally(()=>{u.value=!1})},searchData:b,searchQuery:R,searchSortTab:w,searchFieldTab:P,searchBooksBy:l=>async({page:n=1,onSuccess:s,onError:d})=>{const r=R.value,t=r??b.value.query??"",e=$fetch.create({baseURL:i,onResponse({response:o}){const a=o._data.data;y.value=a.data??[],b.value={total:a.total,perPage:a.per_page,currentPage:a.current_page,lastPage:a.last_page,query:r??""},y.value.length>0&&(s==null||s(a))},onResponseError({response:o}){var a,h;p({message:"Failed to search books by title",toastOps:{description:((a=o._data)==null?void 0:a.message)??"Unknown error",position:"top-right"},type:"error"})(),d==null||d(((h=o._data)==null?void 0:h.message)??"Search failed")}});return u.value=!0,e(`/api/v1/books/search/${l}?q=${encodeURIComponent(t)}&page=${n}${b.value.perPage>=5?`&per_page=${b.value.perPage}`:""}&sort=${l}&direction=${w.value}`,{method:"GET"}).finally(()=>{u.value=!1})}}},{persist:{}});export{p as c,j as u};
