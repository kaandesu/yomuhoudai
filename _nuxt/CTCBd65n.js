import{a8 as U,a9 as k,aa as C,q as f}from"./D5IVA16q.js";const M=U("ToastManagerStore",()=>({create:({message:h,toastOps:c={},type:i="default"})=>{switch(i){case"success":return()=>k.success(h,{...c});case"info":return()=>k.info(h,{...c});case"warning":return()=>k.warning(h,{...c});case"error":return()=>k.error(h,{...c});case"loading":return()=>k.loading(h,{...c});default:return()=>k(h,{...c})}}}));function p(R){return M().create(R)}const G=U("Library",()=>{const c=C().public.devMode!=="false"?"http://127.0.0.1:1234":"https://laravel.yomuhoudai.club",i=f([]),B=f([]),_=f([]),P=f("asc"),b=f("title"),$=f(""),v=f({total:0,perPage:5,currentPage:1,lastPage:0,query:""}),g=f({total:0,perPage:3,currentPage:1,lastPage:0}),u=f(!1),T=()=>$fetch.create({baseURL:c,onResponse({response:r}){var t;i.value=r._data.data??[],i.value.length>0&&(g.value.total=i.value.length,p({message:"Books loaded successfully",toastOps:{description:((t=r._data.data)==null?void 0:t.message)??""},type:"success"})())},onResponseError({response:r}){var t;p({message:"Failed to load books",toastOps:{description:((t=r._data)==null?void 0:t.message)??"Unknown error"},type:"error"})()}})("/api/v1/books",{method:"GET"}),L=async({book:n,onSuccess:r,onError:t})=>{const d=$fetch.create({baseURL:c,onResponse({response:l}){var e,o;if(!l.ok)return;p({message:"Book created successfully",toastOps:{description:((e=l._data)==null?void 0:e.message)??""},type:"success"})();const a=(o=l._data)==null?void 0:o.data;a&&(i.value.length==g.value.total&&i.value.push(a),g.value.total+=1,m(b.value)({}),r==null||r(a))},onResponseError({response:l}){var a,e;p({message:"Failed to create book",toastOps:{description:((a=l._data)==null?void 0:a.message)??"Unknown error"},type:"error"})(),t==null||t(((e=l._data)==null?void 0:e.message)??"Failed to create book")}});return u.value=!0,d("/api/v1/books",{method:"POST",headers:{"Content-Type":"application/json"},body:n}).finally(()=>{u.value=!1})},F=async({page:n=1,onSuccess:r,onError:t})=>{const d=$fetch.create({baseURL:c,onResponse({response:l}){const a=l._data.data,e=a.data??[],o=g.value.currentPage;if(g.value={total:a.total,perPage:a.per_page,currentPage:a.current_page,lastPage:a.last_page},o<g.value.currentPage)for(let s=0;s<e.length;s++)i.value.push(e[s]);g.value.currentPage==1&&(i.value=e),e.length>0&&(r==null||r(a))},onResponseError({response:l}){var a,e;p({message:"Failed to fetch the new books",toastOps:{description:((a=l._data)==null?void 0:a.message)??"Unknown error",position:"top-right"},type:"error"})(),t==null||t(((e=l._data)==null?void 0:e.message)??"Unknown error")}});return u.value=!0,d(`/api/v1/books/search/title?q=%20&page=${n}&per_page=${g.value.perPage}`,{method:"GET"}).finally(()=>{u.value=!1})},O=async({book:n,onSuccess:r,onError:t})=>{const d=$fetch.create({baseURL:c,onResponse({response:e}){var o,s;if(e.ok){if(e._data.data!=null){const y=e._data.data,w=i.value.findIndex(D=>D.id===y.id);w!==-1&&(i.value[w]={...i.value[w],...y})}m(b.value)({}),p({message:"Book updated successfully",toastOps:{description:((o=e._data)==null?void 0:o.message)??""},type:"success"})(),r==null||r((s=e._data)==null?void 0:s.data)}},onResponseError({response:e}){var o,s;p({message:`Failed to update book with id ${n.id}`,toastOps:{description:((o=e._data)==null?void 0:o.message)??"Unknown error"},type:"error"})(),t==null||t(((s=e._data)==null?void 0:s.message)??`Failed to update book with id ${n.id}`)}});u.value=!0;const{id:l,...a}=n;return d(`/api/v1/books/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:a}).finally(()=>{u.value=!1})},x=async({id:n,onSuccess:r,onError:t})=>{const d=$fetch.create({baseURL:c,onResponse({response:l}){var e;if(!l.ok)return;p({message:"Book deleted successfully",toastOps:{description:((e=l._data)==null?void 0:e.message)??""},type:"success"})();const a=i.value.findIndex(o=>o.id===n);a!==-1&&i.value.splice(a,1),_.value.length==1&&v.value.currentPage>=2?m(b.value)({page:v.value.currentPage-1}):m(b.value)({}),g.value.total-=1,r==null||r(l._data)},onResponseError({response:l}){var e,o,s;const a=((e=i.value.find(y=>y.id===n))==null?void 0:e.title)??`book with id ${n}`;p({message:`Failed to delete ${a}`,toastOps:{description:((o=l._data)==null?void 0:o.message)??"Unknown error"},type:"error"})(),t==null||t(((s=l._data)==null?void 0:s.message)??`Failed to delete book with id ${n}`)}});return u.value=!0,d(`/api/v1/books/${n}`,{method:"DELETE"}).finally(()=>{u.value=!1})},q=async({type:n,format:r,onSuccess:t,onError:d})=>{const l=$fetch.create({baseURL:c,responseType:"blob",onResponse({response:a}){if(!a.ok)return;const e=a._data,o=window.URL.createObjectURL(e),s=document.createElement("a");s.href=o,s.setAttribute("download",`books.${r}`),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(o),p({message:"Downloaded successfully!",toastOps:{description:""},type:"success"})(),t==null||t(e)},onResponseError({response:a}){var e,o;p({message:"Failed to download books",toastOps:{description:((e=a._data)==null?void 0:e.message)??"Unknown error"},type:"error"})(),d==null||d(((o=a._data)==null?void 0:o.message)??"Failed to export")}});return u.value=!0,l(`/api/v1/books/export?type=${n}&format=${r}`,{method:"GET"}).finally(()=>{u.value=!1})},m=n=>async({page:r=v.value.currentPage,onSuccess:t,onError:d})=>{const l=$.value,a=l??v.value.query??"",e=$fetch.create({baseURL:c,onResponse({response:o}){if(!o.ok)return;const s=o._data.data;v.value={total:s.total,perPage:s.per_page,currentPage:s.current_page,lastPage:s.last_page,query:l??""},_.value=s.data??[],_.value.length>0&&(t==null||t(s))},onResponseError({response:o}){var s,y;p({message:"Failed to search books by title",toastOps:{description:((s=o._data)==null?void 0:s.message)??"Unknown error",position:"top-right"},type:"error"})(),d==null||d(((y=o._data)==null?void 0:y.message)??"Search failed")}});return u.value=!0,e(`/api/v1/books/search/${n}?q=${encodeURIComponent(a)}&page=${r}${v.value.perPage>=5?`&per_page=${v.value.perPage}`:""}&sort=${n}&direction=${P.value}`,{method:"GET"}).finally(()=>{u.value=!1})};return{loading:u,books:i,searchResults:_,getBooksPaginated:F,overviewPaginationData:g,getBooks:T,createBook:L,updateBook:O,deleteBook:x,suggestions:B,downloadBooks:q,searchData:v,searchQuery:$,searchSortTab:P,searchFieldTab:b,searchBooksBy:m}},{persist:{}});export{p as c,G as u};
